import{a as c,j as a,F as x}from"./jsx-runtime-91a467a5.js";import{P as m}from"./index-1fc0ca9a.js";import{r as h}from"./index-8db94870.js";import{C as w}from"./card.component-8e9238ca.js";import{F as R}from"./form.component-93145808.js";import{c as T}from"./cloneDeep-ce19361f.js";import{i as F}from"./FormBuilder-1c4b949e.js";import{a as O}from"./noop-1202c7f9.js";function n({label:e,key:s,description:t,choices:o,data:i}){return{label:e,key:s,description:t,type:"select",labelPosition:"top",widget:"choicesjs",placeholder:"Select roles...",tooltip:"",multiple:!0,dataSrc:"values",defaultValue:"",data:{values:o},template:"<span>{{ item.label }}</span>",searchEnabled:!0,selectThreshold:0,validate:{required:!1,custom:"",customPrivate:!1},values:i}}function l(e,s=!0){return'<span class="text-sm">'+e+"</span> "+(s?'<hr class="mt-6 mb-5 border-gray-200 mx-20"/>':"")}function P({choices:e}){return{description:"<strong>Elevated permissions allow users to access and modify other user's entities. Assign with caution.</strong>",components:[n({key:"create_own",label:'<h4 class="text-gray-800">Create Own Submissions</h4>',description:l("The Create Own Submissions permission will allow a user with one of the Roles to create a Submission. Upon creating the Submission, the user will be defined as its owner."),choices:e}),n({key:"create_all",label:'<h4 class="text-gray-800">Create All Submissions</h4>',description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Create All Submissions permission will allow a user with one of the Roles to create a new Submission and assign ownership of that Submission to another user.'),choices:e}),n({key:"read_own",label:'<h4 class="text-gray-800">Read Own Submissions</h4>',description:l("The Read Own Submissions permission will allow a user with one of the Roles to read a Submission. A user can only read a Submission if they are defined as its owner."),choices:e}),n({key:"read_all",label:'<h4 class="text-gray-800">Read All Submissions</h4>',description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Read All Submissions permission will allow a user with one of the Roles to read all Submissions regardless of who owns them.'),choices:e}),n({key:"update_own",label:'<h4 class="text-gray-800">Update Own Submissions</h4>',description:l("The Update Own Submissions permission will allow a user with one of the Roles to update a Submission. A user can only update a Submission if they are defined as its owner."),choices:e}),n({key:"update_all",label:'<h4 class="text-gray-800">Update All Submissions</h4>',description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Update All Submissions permission will allow a user with one of the Roles to update a Submission, regardless of who owns the Submission. Additionally with this permission, a user can change the owner of a Submission.'),choices:e}),n({key:"delete_own",label:'<h4 class="text-gray-800">Delete Own Submissions</h4>',description:l("The Delete Own Submissions permission will allow a user with one of the Roles, to delete a Submission. A user can only delete a Submission if they are defined as its owner."),choices:e}),n({key:"delete_all",label:'<h4 class="text-gray-800">Delete All Submissions</h4>',description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Delete All Submissions permission will allow a user with one of the Roles to delete a Submission, regardless of who owns the Submission.',!1),choices:e})]}}function _({choices:e}){return{description:"<strong>Elevated permissions allow users to access and modify other user's entities. Assign with caution.</strong>",components:[n({key:"read_own",label:'<h4 class="text-gray-800">Read Form Definition (Restricted to owner)</h4>',description:l("The Read Own permission will allow a user, with one of the given Roles, to read a form. A user can only read a form if they are defined as its owner."),choices:e}),n({key:"read_all",label:"<h4>Read Form Definition</h4>",description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Read permission will allow a user, with one of the given Roles, to read the form.'),choices:e}),n({key:"update_own",label:'<h4 class="text-gray-800">Update Form Definition (Restricted to owner)</h4>',description:l("The Update Own permission will allow a user, with one of the given Roles, to update a form. A user can only update a form if they are defined as its owner."),choices:e}),n({key:"update_all",label:'<h4 class="text-gray-800">Update Form Definition</h4>',description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Update permission will allow a user, with one of the given Roles, to read and edit the form.'),choices:e}),n({key:"delete_own",label:'<h4 class="text-gray-800">Delete Form Definition (Restricted to owner)</h4>',description:l("The Delete Own permission will allow a user, with one of the given Roles, to delete a form. A user can only delete a form if they are defined as its owner."),choices:e}),n({key:"delete_all",label:'<h4 class="text-gray-800">Delete Form Definition</h4>',description:l('<strong class="text-yellow-600">Elevated Permission:</strong> The Delete permission will allow a user, with one of the given Roles, to delete the form.',!1),choices:e})]}}function E(e){return Object.values(e).map(s=>({label:s.title||"",value:s._id||""}))}function g(e,s=[]){const t=Object.values(s).reduce((o,i)=>(o[i.type]=i.roles,o),{});return(e||[]).filter(Boolean).reduce((o,i)=>({...o,[i]:t[i]||[]}),{})}function S(e){const s=[];return Object.entries(e).forEach(([t,o])=>{t!=="submit"&&s.push({type:t,roles:o})}),s}function k(e){const s=E(e),t=_({choices:s}),o=P({choices:s});return{access:t,submissionAccess:o}}function A(e,s){const t=o=>o.map(({key:i})=>i);return{access:{data:g(t(s.access.components),e.access)},submissionAccess:{data:g(t(s.submissionAccess.components),e.submissionAccess)}}}function C(e,s){return{...T(e),access:S(s.access.data),submissionAccess:S(s.submissionAccess.data)}}function f(e,s,t){return!F(s.data,t[e].data)}function N(e,s,t,o=O){return f(e,s,t)&&(t={...t,[e]:{data:s.data}},o(t)),t}function U({form:e,roles:s,onSubmit:t,options:o}){const i=h.useMemo(()=>k(s),[s]),[r,d]=h.useState(()=>A(e,i)),p=h.useCallback((u,b)=>{N(u,b,r,d)},[r]);return h.useEffect(()=>{const u=A(e,i);e!=null&&e._id&&(f("access",r.access,u)||f("submissionAccess",r.submissionAccess,u))&&d(u)},[e==null?void 0:e._id]),{options:o,form:i,type:e.type,submissions:r,onChange:p,onSubmit:()=>{t&&t(C(e,r))}}}function v({name:e,form:s,submissions:t,options:o,onChange:i,onSubmit:r,children:d}){const[p,u]=h.useState(!0);return c(x,{children:[a(R,{name:e,form:s[e],submission:t[e],onChange:({data:b,isValid:y})=>{y&&i(e,{data:b}),u(y)},options:o}),a("button",{disabled:!p,className:"mt-5 btn btn-primary",onClick:r,children:"Save access"}),d,a("div",{className:"alert alert-warning mt-5",children:"Elevated permissions allow users to access and modify other user's entities. Assign with caution."})]})}function j(e){const{type:s,form:t,submissions:o,options:i,onChange:r,onSubmit:d}=U(e);return c("div",{children:[e.children,c("div",{className:"flex mb-5",children:[a(w,{label:"Manage submission access",className:"flex-1",children:a(v,{name:"submissionAccess",form:t,submissions:o,onChange:r,onSubmit:d,options:i,children:e.children})}),a("div",{className:"w-1/4 pl-4",children:c(w,{label:"About Submission Data Permissions",children:[a("p",{children:"Submission Data Permissions allow you to control who can create, view, and modify form submission data."}),c("ul",{className:"mt-5 pl-7 list-disc",children:[c("li",{className:"pb-2",children:[a("strong",{children:"Own Permissions"})," - These permissions apply if the user is the original creator of the submission data and is listed as the owner of the submission in submission.owner. This allows users to create and edit their own submission data without seeing other user's data."]}),c("li",{children:[a("strong",{children:"All Permissions"})," - These permissions apply to all submission data regardless of who owns it."]})]})]})})]}),c("div",{className:"flex mb-5",children:[a(w,{label:`Manage ${s} definition access`,className:"flex-1",children:a(v,{name:"access",form:t,submissions:o,onChange:r,onSubmit:d,options:i,children:e.children})}),a("div",{className:"w-1/4 pl-4",children:c(w,{label:"About Form Definition Access",children:[a("p",{children:"These permissions allow you to give access to a single form's JSON definition so they can render the form."}),a("p",{children:"Typically you will want to allow all of your roles to be able to Read the form definition."}),c("p",{children:["Each form also has an owner at ",a("strong",{children:"form.owner"})," which is the user who created the form. In some applications users are allowed to create their own forms. In those cases it is helpful to have Owner based permissions as well."]})]})})]})]})}j.propTypes={type:m.string.isRequired,form:m.object,roles:m.any,children:m.any,options:m.any,onSubmit:m.func};export{j as F};
//# sourceMappingURL=formAccess.component-f80ea610.js.map
