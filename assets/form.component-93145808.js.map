{"version":3,"file":"form.component-93145808.js","sources":["../../../react-formio/src/components/form/useForm.hook.ts","../../../react-formio/src/components/form/form.component.tsx"],"sourcesContent":["import { ExtendedComponentSchema, Form } from \"formiojs\";\nimport cloneDeep from \"lodash/cloneDeep\";\nimport isEqual from \"lodash/isEqual\";\nimport { useEffect, useRef } from \"react\";\n\nimport { FormOptions, FormSchema, Submission } from \"../../interfaces\";\n\nexport interface ChangedSubmission<T = any> extends Submission<T> {\n  changed: {\n    component: ExtendedComponentSchema;\n    instance: any;\n    value: any;\n  } & Record<string, any>;\n  isValid: boolean;\n}\n\nexport interface FormPageChangeProps<Data = any> {\n  page: number;\n  submission: Submission<Data>;\n}\n\nexport interface UseFormHookProps<Data = any> extends Record<string, any> {\n  src?: string;\n  /**\n   * url to fetch form\n   */\n  url?: string;\n  /**\n   * Raw form object\n   */\n  form?: Partial<FormSchema>;\n  /**\n   * Configuration option\n   */\n  options?: FormOptions;\n  /**\n   * Data submission\n   */\n  submission?: Submission<Data>;\n\n  /// events\n  onPrevPage?: (obj: FormPageChangeProps<Data>) => void;\n  onNextPage?: (obj: FormPageChangeProps<Data>) => void;\n  onCancel?: Function;\n  onChange?: (submission: ChangedSubmission) => void;\n  onCustomEvent?: (obj: { type: string; event: string; component: ExtendedComponentSchema; data: any }) => void;\n  onComponentChange?: (component: ExtendedComponentSchema) => void;\n  onSubmit?: (submission: Submission<Data>) => void;\n  onAsyncSubmit?: (submission: Submission<Data>) => Promise<any>;\n  onSubmitDone?: (submission: Submission<Data>) => void;\n  onFormLoad?: Function;\n  onError?: (errors: any) => void;\n  onRender?: () => void;\n  onAttach?: Function;\n  onBuild?: Function;\n  onFocus?: Function;\n  onBlur?: Function;\n  onInitialized?: Function;\n  onFormReady?: (formio: any) => void;\n}\n\nfunction useEvent(event: string, callback: any, events: Map<string, any>) {\n  useEffect(() => {\n    if (callback) {\n      events.set(event, callback);\n    }\n  }, [callback, event, events]);\n}\n\nfunction useEvents(funcs: any) {\n  const events = useRef<Map<string, any>>(new Map());\n\n  const hasEvent = (event: string) => {\n    return funcs.hasOwnProperty(event) && typeof funcs[event] === \"function\";\n  };\n\n  const emit = (event: string, ...args: any[]) => {\n    if (hasEvent(event)) {\n      const fn = events.current.has(event) ? events.current.get(event) : funcs[event];\n      return fn(...args);\n    }\n  };\n\n  useEvent(\"onBlur\", funcs[\"onBlur\"], events.current);\n  useEvent(\"onPrevPage\", funcs[\"onPrevPage\"], events.current);\n  useEvent(\"onNextPage\", funcs[\"onNextPage\"], events.current);\n  useEvent(\"onCancel\", funcs[\"onCancel\"], events.current);\n  useEvent(\"onChange\", funcs[\"onChange\"], events.current);\n  useEvent(\"onCustomEvent\", funcs[\"onCustomEvent\"], events.current);\n  useEvent(\"onComponentChange\", funcs[\"onComponentChange\"], events.current);\n  useEvent(\"onSubmit\", funcs[\"onSubmit\"], events.current);\n  useEvent(\"onAsyncSubmit\", funcs[\"onAsyncSubmit\"], events.current);\n  useEvent(\"onSubmitDone\", funcs[\"onSubmitDone\"], events.current);\n  useEvent(\"onFormLoad\", funcs[\"onFormLoad\"], events.current);\n  useEvent(\"onError\", funcs[\"onError\"], events.current);\n  useEvent(\"onRender\", funcs[\"onRender\"], events.current);\n  useEvent(\"onAttach\", funcs[\"onAttach\"], events.current);\n  useEvent(\"onBuild\", funcs[\"onBuild\"], events.current);\n  useEvent(\"onFocus\", funcs[\"onFocus\"], events.current);\n  useEvent(\"onBlur\", funcs[\"onBlur\"], events.current);\n  useEvent(\"onInitialized\", funcs[\"onInitialized\"], events.current);\n\n  return { events, emit, hasEvent };\n}\n\nexport function useForm<Data = any>(props: UseFormHookProps<Data>) {\n  const { src, form, options = {}, submission, url, ...funcs } = props;\n  const element = useRef<any>();\n  const isLoaded = useRef<boolean>();\n  const instance = useRef<Form>();\n  const { emit, hasEvent } = useEvents(funcs);\n\n  async function customValidation(submission: Submission, callback: (err: Error | null) => void) {\n    if (hasEvent(\"onAsyncSubmit\")) {\n      try {\n        await emit(\"onAsyncSubmit\", submission, instance.current);\n      } catch (err: any) {\n        callback(err?.errors || err);\n      }\n    } else {\n      callback(null);\n    }\n  }\n\n  const createWebForm = (srcOrForm: any, options: any) => {\n    options = Object.assign({}, options);\n    srcOrForm = typeof srcOrForm === \"string\" ? srcOrForm : cloneDeep(srcOrForm);\n\n    if (!instance.current) {\n      isLoaded.current = false;\n      options.hooks = {\n        ...(options.hooks || {}),\n        customValidation: options?.hooks?.customValidation || customValidation\n      };\n\n      instance.current = new Form(element.current, srcOrForm, options);\n\n      instance.current.onAny((event: string, ...args: any[]): void => {\n        if (!instance.current) {\n          return;\n        }\n\n        if (event.startsWith(\"formio.\")) {\n          const eventName = `on${event.charAt(7).toUpperCase()}${event.slice(8)}`;\n\n          if (eventName === \"onChange\" && !args[0].changed) {\n            return;\n          }\n\n          emit(eventName, ...args, instance.current);\n        }\n      });\n\n      instance.current.ready.then((formio: any) => {\n        submission && (formio.submission = cloneDeep(submission));\n\n        if (props.onFormReady) {\n          props.onFormReady(formio);\n        }\n\n        isLoaded.current = true;\n      });\n    }\n\n    return instance.current;\n  };\n\n  useEffect(() => {\n    if (instance.current) {\n      instance.current.ready.then((formio: any) => {\n        if (isEqual(formio.submission.data, submission?.data)) {\n          return;\n        }\n\n        submission && (formio.submission = cloneDeep(submission));\n      });\n    }\n  }, [submission]);\n\n  useEffect(() => {\n    if (form && instance.current) {\n      instance.current.ready.then((formio: any) => {\n        formio.form = form;\n        if (url) {\n          formio.url = url;\n        }\n      });\n    }\n  }, [form, url]);\n\n  useEffect(() => {\n    if (src) {\n      if (instance.current) {\n        isLoaded.current = false;\n        (instance.current as any).destroy(true);\n      }\n\n      createWebForm(src, options);\n    }\n  }, [src]);\n\n  useEffect(() => {\n    if (form) {\n      createWebForm(form, options);\n    }\n\n    return () => {\n      isLoaded.current = false;\n      instance.current && (instance.current as any).destroy(true);\n    };\n  }, []);\n\n  return {\n    element\n  };\n}\n","import { Components } from \"formiojs\";\nimport AllComponents from \"formiojs/components\";\nimport PropTypes from \"prop-types\";\nimport React from \"react\";\n\nimport { useForm, UseFormHookProps } from \"./useForm.hook\";\n\nComponents.setComponents(AllComponents);\n\nexport interface FormProps<Data = any> extends UseFormHookProps<Data> {\n  name?: string;\n  /**\n   *\n   */\n  className?: string;\n}\n\nexport function Form<Data = any>(props: Partial<FormProps<Data>>) {\n  const { element } = useForm(props);\n\n  return <div data-testid={`formioContainer${props.name || \"\"}`} ref={element} className={props.className} />;\n}\n\nForm.propTypes = {\n  name: PropTypes.string,\n  className: PropTypes.string,\n  /**\n   *\n   */\n  src: PropTypes.string,\n  /**\n   * url to fetch form\n   */\n  url: PropTypes.string,\n  /**\n   * Raw form object\n   */\n  form: PropTypes.object,\n  /**\n   * Data submission\n   */\n  submission: PropTypes.object,\n  /**\n   * Configuration option\n   */\n  options: PropTypes.shape({\n    readOnly: PropTypes.bool,\n    noAlerts: PropTypes.bool,\n    i18n: PropTypes.any,\n    template: PropTypes.string,\n    saveDraft: PropTypes.bool,\n    hooks: PropTypes.any\n  }),\n  onPrevPage: PropTypes.func,\n  onNextPage: PropTypes.func,\n  onCancel: PropTypes.func,\n  onChange: PropTypes.func,\n  onCustomEvent: PropTypes.func,\n  onComponentChange: PropTypes.func,\n  onSubmit: PropTypes.func,\n  onAsyncSubmit: PropTypes.func,\n  onSubmitDone: PropTypes.func,\n  onFormLoad: PropTypes.func,\n  onError: PropTypes.func,\n  onRender: PropTypes.func,\n  onAttach: PropTypes.func,\n  onBuild: PropTypes.func,\n  onFocus: PropTypes.func,\n  onBlur: PropTypes.func,\n  onInitialized: PropTypes.func,\n  onFormReady: PropTypes.func,\n  formioform: PropTypes.any\n};\n"],"names":["useEvent","event","callback","events","useEffect","useEvents","funcs","useRef","hasEvent","emit","args","useForm","props","src","form","options","submission","url","element","isLoaded","instance","customValidation","err","createWebForm","srcOrForm","cloneDeep","Form","eventName","formio","isEqual","Components","AllComponents","jsx","PropTypes"],"mappings":"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"}